# React

## 单向数据流

以 email 订阅功能为例，React 的数据流是 **单向数据流**：

```
┌──────────────────────────────────────────────────────────────┐
│                     React 单向数据流                          │
└──────────────────────────────────────────────────────────────┘

  ┌───────────────────────────────────────────────────────────┐
  │  1. 状态定义 (State)                                       │
  │     const [email, setEmail] = useState('')                │
  │              ↓                      ↓                     │
  │           当前值                 更新函数                  │
  └───────────────────────────────────────────────────────────┘
                              │
                              ▼
  ┌───────────────────────────────────────────────────────────┐
  │  2. 数据向下流 (State → UI)                                │
  │                                                           │
  │     <input value={email} ... />                           │
  │                 ↑                                         │
  │          email 的值显示在输入框里                          │
  └───────────────────────────────────────────────────────────┘
                              │
                              ▼
  ┌───────────────────────────────────────────────────────────┐
  │  3. 事件向上传 (UI → State)                                │
  │                                                           │
  │     onChange={(e) => setEmail(e.target.value)}            │
  │                              ↑                            │
  │                    用户输入触发 setEmail                   │
  │                    更新 state 中的 email                   │
  └───────────────────────────────────────────────────────────┘
                              │
                              ▼
  ┌───────────────────────────────────────────────────────────┐
  │  4. 重新渲染 (Re-render)                                   │
  │                                                           │
  │     state 改变 → 组件重新渲染 → input 显示新值              │
  └───────────────────────────────────────────────────────────┘
```

### 具体流程（以用户输入 "test@qq.com" 为例）

| 步骤 | 发生了什么 | 代码位置 |
|------|-----------|----------|
| 1 | 页面加载，`email = ''` | useState 初始化 |
| 2 | 用户输入 "t" | 键盘事件 |
| 3 | 触发 `onChange`，调用 `setEmail('t')` | input onChange |
| 4 | React 更新 state，`email = 't'` | - |
| 5 | 组件重新渲染，input 显示 "t" | input value |
| 6 | 用户继续输入... 重复 2-5 | - |
| 7 | 点击 Subscribe 按钮 | button onClick |
| 8 | 触发 `handleSubscribe`，发送 email 到 API | fetch 调用 |

### 核心概念：受控组件 (Controlled Component)

```tsx
<input
  value={email}                              // ← 显示什么：由 state 决定
  onChange={(e) => setEmail(e.target.value)} // ← 怎么改：通过事件更新 state
/>
```

这种模式叫**受控组件**：
- input 的值完全由 React state 控制
- 用户输入 → 触发事件 → 更新 state → 重新渲染 → 显示新值

这样 React 就能始终知道输入框里是什么内容，方便后续处理（如发送 API）。